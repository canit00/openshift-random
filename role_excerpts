## Node Preparation
- name: validate default trust policy
  command: atomic trust show
  register: atomic

- debug:
    msg: "trust default set to accept-all"
  when: atomic.stdout | search("accept")

- name: Add Red Hat to trusted registries
  command: >
    atomic trust add registry.access.redhat.com
    --pubkeys /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
    --sigstore https://access.redhat.com/webassets/docker/content/sigstore
    --type signedBy
  environment:
    http_proxy: http://<proxy>:8080
    https_proxy: http://<proxy>:8080
  when: ansible_system_vendor != "Microsoft Corporation"
